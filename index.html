<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VickyLuna - Ruleta Interactiva</title>
<meta name="description" content="¬°Gira la ruleta m√°gica y gana premios exclusivos! Ingresa tu c√≥digo para empezar.">

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="images/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon.ico">

<!-- METADATOS PARA REDES SOCIALES (OPEN GRAPH) -->
<meta property="og:title" content="VickyLuna - La Ruleta de la Suerte üíñ" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://xvickyluna.netlify.app/" /> <!-- ¬°Recuerda cambiar esto! -->
<meta property="og:image" content="https://i.imgur.com/e19Cdnc.png" /> <!-- ¬°Y esto tambi√©n! -->
<meta property="og:description" content="¬°Gira la ruleta m√°gica y gana premios exclusivos! Ingresa tu c√≥digo para empezar." />
<meta property="og:site_name" content="VickyLuna" />

<style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap');

/* === VARIABLES DE COLOR (TEMA TEEN CUTE ELEGANTE) === */
:root {
--bg-fondo-a: #fde7f3;
--bg-fondo-b: #e8ddff;
--bg-fondo-c: #d8f1ff;
--accent-principal: #ff4fa3;
--accent-secundario: #7a5cff;
--texto-oscuro: #2b2b35;
--texto-suave: #6b6b7a;
--glass-white: rgba(255, 255, 255, 0.92);
--glass-border: rgba(255, 255, 255, 0.35);
--accent-soft: rgba(255, 79, 163, 0.15);
--accent-border: rgba(255, 79, 163, 0.35);
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { 
font-family: 'Poppins', sans-serif; text-align: center; min-height: 100vh;
background: linear-gradient(-45deg, var(--bg-fondo-a), var(--bg-fondo-b), var(--bg-fondo-c), var(--bg-fondo-b), var(--bg-fondo-a));
background-size: 400% 400%; 
animation: gradientMove 10s ease-in-out infinite;
position: relative; overflow-x: hidden;
}
@keyframes gradientMove { 
0% { background-position: 0% 50%; } 
25% { background-position: 100% 50%; }
50% { background-position: 100% 100%; }
75% { background-position: 0% 100%; }
100% { background-position: 0% 50%; }
}
.background-shapes { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
.particle { position: absolute; pointer-events: none; opacity: 0.6; animation: floatParticle 8s ease-in-out infinite; }
.particle.heart { font-size: 20px; color: var(--accent-principal); animation: floatHeart 10s ease-in-out infinite; }
.particle.sparkle { width: 8px; height: 8px; background: radial-gradient(circle, var(--accent-secundario), var(--accent-principal)); border-radius: 50%; animation: floatSparkle 6s ease-in-out infinite; }
.particle.star { font-size: 16px; color: var(--accent-secundario); animation: floatStar 12s ease-in-out infinite; }
@keyframes floatParticle {
0%, 100% { transform: translateY(0px) translateX(0px) rotate(0deg); opacity: 0.3; }
25% { transform: translateY(-30px) translateX(15px) rotate(90deg); opacity: 0.7; }
50% { transform: translateY(-20px) translateX(-10px) rotate(180deg); opacity: 0.5; }
75% { transform: translateY(-40px) translateX(20px) rotate(270deg); opacity: 0.8; }
}
@keyframes floatHeart {
0%, 100% { transform: translateY(0px) scale(1) rotate(0deg); opacity: 0.4; }
33% { transform: translateY(-50px) scale(1.2) rotate(15deg); opacity: 0.8; }
66% { transform: translateY(-30px) scale(0.8) rotate(-10deg); opacity: 0.6; }
}
@keyframes floatSparkle {
0%, 100% { transform: translateY(0px) scale(1); opacity: 0.5; box-shadow: 0 0 10px var(--accent-secundario); }
50% { transform: translateY(-40px) scale(1.5); opacity: 1; box-shadow: 0 0 20px var(--accent-principal); }
}
@keyframes floatStar {
0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); opacity: 0.4; }
25% { transform: translateY(-35px) rotate(180deg) scale(1.1); opacity: 0.7; }
50% { transform: translateY(-60px) rotate(360deg) scale(0.9); opacity: 0.9; }
75% { transform: translateY(-25px) rotate(540deg) scale(1.2); opacity: 0.6; }
}
/* === PART√çCULAS REACTIVAS AL MOUSE === */
.mouse-particle {
position: fixed;
left: 0;
top: 0;
border-radius: 50%;
pointer-events: none;
opacity: 0;
transition: transform 1s ease-out, opacity 1s ease-out;
z-index: 1;
}

.shape { 
position: absolute; border-radius: 50%; opacity: 0.08; 
animation: float 15s ease-in-out infinite; 
}
.shape:nth-child(1) { width: 80px; height: 80px; background: var(--accent-principal); top: 10%; left: 10%; }
.shape:nth-child(2) { width: 120px; height: 120px; background: var(--accent-secundario); top: 20%; right: 15%; animation-delay: 2s; }
.shape:nth-child(3) { width: 60px; height: 60px; background: var(--bg-fondo-c); bottom: 20%; left: 20%; animation-delay: 4s; }
.shape:nth-child(4) { width: 100px; height: 100px; background: var(--accent-principal); bottom: 10%; right: 10%; animation-delay: 1s; }
@keyframes float {
0% { transform: translateY(0) rotate(0deg); }
33% { transform: translateY(-20px) rotate(45deg); }
66% { transform: translateY(15px) rotate(-30deg); }
100% { transform: translateY(0) rotate(0deg); }
}
.container {
position: relative; z-index: 1; padding: 20px; display: flex; flex-direction: column;
align-items: center; justify-content: center; min-height: 100vh;
max-width: 1400px; margin: 0 auto; gap: 20px;
}
.main-content {
display: flex; flex-direction: column; align-items: center; justify-content: center;
width: 100%; max-width: 1200px; flex: 1; gap: 40px;
}
@media (min-width: 992px) {
.main-content {
display: grid; grid-template-columns: 1fr auto 1fr;
align-items: center; gap: 60px;
}
.controls-container { grid-column: 1 / 2; justify-self: end; }
.ruleta-section { grid-column: 2 / 3; }
.historial-container { 
grid-column: 3 / 4; 
justify-self: start; 
display: none; /* Oculto por defecto en escritorio */
}
.historial-container.visible { display: flex; }
}
.controls-container { display: flex; flex-direction: column; align-items: center; gap: 25px; }
.ruleta-section { display: flex; flex-direction: column; align-items: center; gap: 30px; flex-shrink: 0; }
.historial-container { display: flex; flex-direction: column; align-items: center; gap: 25px; }

/* === ESTILOS DEL HISTORIAL DE PREMIOS === */
.historial-section {
background: var(--glass-white); padding: 25px; border-radius: 25px;
box-shadow: 0 15px 35px rgba(0,0,0,0.1); backdrop-filter: blur(15px);
border: 1px solid var(--glass-border); width: 320px; max-height: 500px;
}

.historial-title {
font-family: 'Dancing Script', cursive; 
color: var(--accent-secundario); 
font-size: 2rem; 
font-weight: 700; 
text-shadow: 0px 4px 15px rgba(0, 0, 0, 0.4), 0 0 10px rgba(255, 255, 255, 0.3);
margin-bottom: 20px;
text-align: center;
}

.historial-lista {
max-height: 380px;
overflow-y: auto;
padding-right: 10px;
}

.historial-lista::-webkit-scrollbar {
width: 8px;
}

.historial-lista::-webkit-scrollbar-track {
background: rgba(232, 221, 255, 0.3);
border-radius: 10px;
}

.historial-lista::-webkit-scrollbar-thumb {
background: linear-gradient(45deg, var(--accent-principal), var(--accent-secundario));
border-radius: 10px;
border: 2px solid var(--glass-border);
}

.historial-lista::-webkit-scrollbar-thumb:hover {
background: linear-gradient(45deg, var(--accent-secundario), var(--accent-principal));
}

.premio-item {
background: linear-gradient(135deg, var(--accent-soft), rgba(122, 92, 255, 0.08));
border: 2px solid var(--accent-border);
border-radius: 15px;
padding: 15px;
margin-bottom: 12px;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.premio-item:hover {
transform: translateX(5px);
box-shadow: 0 8px 20px rgba(255, 79, 163, 0.2);
border-color: rgba(122, 92, 255, 0.5);
}

.premio-item::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
transition: left 0.5s ease;
}

.premio-item:hover::before {
left: 100%;
}

.premio-nombre {
font-weight: 700;
color: var(--accent-secundario);
font-size: 0.95rem;
margin-bottom: 5px;
text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
}

.premio-fecha {
font-size: 0.8rem;
color: var(--texto-suave);
font-weight: 500;
display: flex;
align-items: center;
gap: 5px;
}

.premio-numero {
position: absolute;
top: 8px;
right: 12px;
background: linear-gradient(45deg, var(--accent-principal), var(--accent-secundario));
color: white;
border-radius: 50%;
width: 25px;
height: 25px;
display: flex;
align-items: center;
justify-content: center;
font-size: 0.7rem;
font-weight: bold;
box-shadow: 0 2px 8px rgba(122, 92, 255, 0.3);
}

.historial-vacio {
text-align: center;
color: var(--texto-suave);
font-style: italic;
padding: 30px 20px;
background: rgba(255, 255, 255, 0.5);
border-radius: 15px;
border: 2px dashed var(--accent-border);
}

.historial-vacio::before {
content: 'üéÅ';
display: block;
font-size: 2rem;
margin-bottom: 10px;
opacity: 0.5;
}
.controls-section {
display: flex; flex-direction: column; align-items: center; gap: 20px;
background: var(--glass-white); padding: 35px; border-radius: 25px;
box-shadow: 0 15px 35px rgba(0,0,0,0.1); backdrop-filter: blur(15px);
border: 1px solid var(--glass-border); width: 320px;
}
.controls-title { 
font-family: 'Dancing Script', cursive; 
color: var(--accent-secundario); 
font-size: 2.5rem; 
font-weight: 700; 
text-shadow: 0px 4px 15px rgba(0, 0, 0, 0.4), 0 0 10px rgba(255, 255, 255, 0.3);
}
        #ruleta { margin: 0 auto; width: 450px; height: 450px; border: 10px solid var(--accent-principal); border-radius: 50%; position: relative; box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
        #flecha { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 50px solid var(--accent-principal); position: absolute; left: 50%; top: -50px; transform: translateX(-50%); z-index: 10; }
        #opciones { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            top: 0; 
            left: 0; 
            pointer-events: none; 
            border-radius: 50%;
        }
        
        .is-idling {
            animation: slowRotate 30s linear infinite;
        }
        
        #ruleta { 
            margin: 0 auto; 
            width: 450px; 
            height: 450px; 
            border: 10px solid var(--accent-principal); 
            border-radius: 50%; 
            position: relative; 
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            background: linear-gradient(135deg, var(--accent-principal), var(--accent-secundario));
        }
        
        #ruleta::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 50%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 1;
            filter: blur(8px) brightness(0.4) contrast(1.2);
        }
        
        #ruleta.with-background::before {
            opacity: 1;
        }
        
        #flecha { 
            width: 0; 
            height: 0; 
            border-left: 25px solid transparent; 
            border-right: 25px solid transparent; 
            border-bottom: 50px solid var(--accent-principal); 
            position: absolute; 
            left: 50%; 
            top: -50px; 
            transform: translateX(-50%); 
            z-index: 15;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        #opciones { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            top: 0; 
            left: 0; 
            pointer-events: none; 
            border-radius: 50%;
            z-index: 10;
        }
#mensaje { 
margin-top: 10px; 
font-size: 1.1rem; 
color: var(--accent-secundario); 
font-weight: 600; 
background: var(--glass-white); 
padding: 15px 25px; 
border-radius: 20px; 
display: inline-block; 
box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
min-height: 35px; 
backdrop-filter: blur(10px);
border: 2px solid var(--glass-border);
text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
}
.form-title { 
font-family: 'Dancing Script', cursive; 
font-size: 1.6rem; 
color: var(--accent-secundario); 
margin-bottom: 10px; 
text-shadow: 2px 2px 5px rgba(0,0,0,0.15);
}
#codigo { 
padding: 18px 20px; 
font-size: 1.1rem; 
border: 3px solid var(--accent-principal); 
border-radius: 20px; 
width: 100%; 
text-align: center; 
transition: all 0.3s ease;
background: var(--glass-white);
font-weight: 600;
}

#codigo:focus {
outline: none;
background: white;
box-shadow: 0 0 30px rgba(255, 79, 163, 0.5);
border-color: var(--accent-secundario);
transform: translateY(-2px);
}
#validarBtn { 
padding: 15px 25px; 
font-size: 1rem; 
background: linear-gradient(45deg, var(--accent-principal), var(--accent-secundario)); 
color: white; 
border: none; 
border-radius: 20px; 
cursor: pointer; 
font-weight: 600; 
width: 100%; 
text-transform: uppercase; 
transition: all 0.3s ease;
box-shadow: 0 4px 15px rgba(122, 92, 255, 0.3);
}

#validarBtn:hover:not(:disabled) {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(122, 92, 255, 0.4);
}
#girarBtn { 
padding: 18px 50px; 
font-size: 1.2rem; 
background: linear-gradient(45deg, var(--accent-principal), var(--accent-secundario), var(--accent-principal)); 
color: white; 
border: none; 
border-radius: 30px; 
cursor: pointer; 
font-weight: 700; 
min-width: 280px; 
transition: all 0.3s ease;
box-shadow: 0 6px 20px rgba(255, 79, 163, 0.4);
text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}

#girarBtn:hover:not(:disabled) {
transform: translateY(-4px) scale(1.02);
box-shadow: 0 12px 30px rgba(255, 79, 163, 0.5);
}
#girarBtn:disabled { background: linear-gradient(45deg, #ccc, #999); cursor: not-allowed; }

.button {
transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
cursor: pointer;
}

.button:hover:not(:disabled) {
transform: translateY(-3px) scale(1.05);
box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
filter: brightness(1.1);
}
.popup-overlay {
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px); display: flex; justify-content: center;
align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease;
}
.popup-overlay.show { opacity: 1; visibility: visible; }
.popup-content {
background: linear-gradient(135deg, var(--accent-principal), var(--accent-secundario)); border-radius: 30px; padding: 40px; text-align: center;
max-width: 500px; width: 90%; transform: scale(0.5); transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
}
.popup-overlay.show .popup-content { transform: scale(1); }
.popup-title { font-family: 'Dancing Script', cursive; font-size: 3rem; color: white; margin-bottom: 20px; }
.popup-prize { font-size: 1.5rem; color: white; font-weight: 700; margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 15px; }
.popup-instructions { font-size: 0.9rem; color: white; opacity: 0.9; margin-top: 25px; font-weight: 500; }
.popup-close { background: white; color: var(--accent-secundario); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 700; font-size: 1.1rem; cursor: pointer; margin-top: 20px; }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes slowRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .mensaje-update {
            animation: fadeIn 0.5s ease-in-out;
        }

/* === DISE√ëO RESPONSIVO COMPLETO === */

/* Tablets y pantallas medianas */
@media (max-width: 992px) {
    /* --- INICIA EL LAYOUT GRID PARA TABLET/M√ìVIL --- */
    .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px; /* Gap m√°s reducido para m√≥viles */
        align-items: start;
        justify-items: center;
        width: 100%;
    }

    /* Posicionamiento en la Grid */
    .controls-container {
        grid-column: 1 / 2;
        justify-self: center; /* Centrado en su columna */
    }
    .historial-container {
        grid-column: 2 / 3;
        justify-self: center; /* Centrado en su columna */
    }
    .ruleta-section {
        grid-column: 1 / -1; /* Ocupa todo el ancho */
    }

    /* Tama√±os flexibles para los Paneles */
    .controls-section,
    .historial-section {
        width: 100%;
        max-width: 280px; /* Reducido para que quepan mejor lado a lado */
        padding: 15px; /* Padding reducido */
        margin: 0;
        height: auto;
    }

    /* Otros ajustes generales para tablet/m√≥vil */
    .historial-section, .historial-lista { max-height: 400px; }
    .historial-title { font-size: 1.8rem; }
    .controls-title { font-size: 2.2rem; }
    #ruleta { width: 400px; height: 400px; border-width: 8px; }
    #flecha { border-left-width: 22px; border-right-width: 22px; border-bottom-width: 45px; top: -45px; }
    #girarBtn { min-width: 250px; padding: 16px 40px; font-size: 1.1rem; }
}

/* Tablets peque√±as y m√≥viles grandes */
@media (max-width: 768px) {
.container {
padding: 15px;
gap: 15px;
}

.historial-section {
width: 280px;
padding: 18px;
max-height: 350px;
}

.historial-title {
font-size: 1.6rem;
margin-bottom: 15px;
}

.historial-lista {
max-height: 250px;
}

.premio-item {
padding: 12px;
margin-bottom: 10px;
}

.premio-nombre {
font-size: 0.9rem;
}

.premio-fecha {
font-size: 0.75rem;
}

.controls-title {
font-size: 2rem;
margin-bottom: 15px;
}

.form-title {
font-size: 1.6rem;
margin-bottom: 12px;
}

#codigo {
font-size: 0.95rem;
padding: 15px 18px;
}

#validarBtn {
font-size: 0.9rem;
padding: 14px 22px;
}

#mensaje {
font-size: 1rem;
padding: 12px 20px;
}

#ruleta {
width: 350px;
height: 350px;
border-width: 7px;
}

            #ruleta::before {
                filter: blur(6px) brightness(0.35) contrast(1.3);
            }
            
#flecha {
border-left-width: 20px;
border-right-width: 20px;
border-bottom-width: 40px;
top: -40px;
}

.form-title {
font-size: 1.5rem;
}

#codigo {
padding: 14px 18px;
font-size: 1rem;
}

#validarBtn {
padding: 14px 22px;
font-size: 0.95rem;
}

#girarBtn {
min-width: 220px;
padding: 15px 35px;
font-size: 0.95rem;
}

#mensaje {
font-size: 0.9rem;
padding: 10px 16px;
}

.popup-content {
padding: 30px;
max-width: 400px;
}

.popup-title {
font-size: 2.5rem;
}

.popup-prize {
font-size: 1.3rem;
padding: 12px;
}

.popup-close {
padding: 12px 25px;
font-size: 1rem;
}
}

/* M√≥viles peque√±os */
@media (max-width: 480px) {
.container {
padding: 10px;
}

.historial-section {
width: 260px;
padding: 15px;
max-height: 300px;
}

.historial-title {
font-size: 1.4rem;
margin-bottom: 12px;
}

.historial-lista {
max-height: 200px;
}

.premio-item {
padding: 10px;
margin-bottom: 8px;
}

.premio-nombre {
font-size: 0.85rem;
}

.premio-fecha {
font-size: 0.7rem;
}

.premio-numero {
width: 20px;
height: 20px;
font-size: 0.6rem;
}

.controls-title {
font-size: 1.8rem;
text-align: center;
margin-bottom: 10px;
}

#ruleta {
width: 280px;
height: 280px;
border-width: 6px;
}

            #ruleta::before {
                filter: blur(5px) brightness(0.3) contrast(1.4);
            }
            
#flecha {
border-left-width: 18px;
border-right-width: 18px;
border-bottom-width: 35px;
top: -35px;
}

.form-title {
font-size: 1.4rem;
}

#codigo {
padding: 12px 15px;
font-size: 0.95rem;
}

#validarBtn {
padding: 12px 18px;
font-size: 0.9rem;
}

#girarBtn {
min-width: 200px;
padding: 14px 30px;
font-size: 0.9rem;
}

#mensaje {
font-size: 0.85rem;
padding: 8px 14px;
margin-top: 8px;
}

.popup-content {
padding: 25px;
max-width: 340px;
}

.popup-title {
font-size: 2.2rem;
margin-bottom: 15px;
}

.popup-prize {
font-size: 1.2rem;
padding: 10px;
margin: 15px 0;
}

.popup-instructions {
font-size: 0.8rem;
margin-top: 20px;
}

.popup-close {
padding: 10px 20px;
font-size: 0.95rem;
}

/* Ajustar formas de fondo para m√≥viles */
.shape:nth-child(1) { width: 50px; height: 50px; }
.shape:nth-child(2) { width: 70px; height: 70px; }
.shape:nth-child(3) { width: 40px; height: 40px; }
.shape:nth-child(4) { width: 60px; height: 60px; }

.particle.heart { font-size: 16px; }
.particle.sparkle { width: 6px; height: 6px; }
.particle.star { font-size: 12px; }
}

/* M√≥viles muy peque√±os */
@media (max-width: 360px) {
.controls-title {
font-size: 1.6rem;
}

#ruleta {
width: 250px;
height: 250px;
border-width: 5px;
}

            #ruleta::before {
                filter: blur(4px) brightness(0.25) contrast(1.5);
            }
            
#flecha {
border-left-width: 15px;
border-right-width: 15px;
border-bottom-width: 30px;
top: -30px;
}

#girarBtn {
min-width: 180px;
padding: 12px 25px;
font-size: 0.85rem;
}

.popup-content {
padding: 20px;
max-width: 300px;
}

.popup-title {
font-size: 2rem;
}
}

@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

/* === SISTEMA DE NOTIFICACIONES === */
.notification-banner {
position: fixed;
top: 0;
left: 0;
width: 100%;
z-index: 10000;
display: none;
transform: translateY(-100%);
transition: transform 0.3s ease;
}

.notification-banner.show {
transform: translateY(0);
}

.notification-banner.success {
background: linear-gradient(135deg, var(--accent-secundario), var(--accent-principal));
}

.notification-banner.error {
background: linear-gradient(135deg, #d9534f, #c9302c);
}

.notification-banner.warning {
background: linear-gradient(135deg, var(--accent-principal), var(--accent-secundario));
}

.notification-content {
display: flex;
justify-content: space-between;
align-items: center;
padding: 15px 20px;
max-width: 1200px;
margin: 0 auto;
}

.notification-text {
color: white;
font-weight: 600;
font-size: 1rem;
flex-grow: 1;
}

.notification-close {
background: none;
border: none;
color: white;
font-size: 1.5rem;
font-weight: bold;
cursor: pointer;
padding: 0 10px;
opacity: 0.8;
transition: opacity 0.3s ease;
}

.notification-close:hover {
opacity: 1;
}

/* === INDICADORES DE CARGA === */
.loading {
position: relative;
pointer-events: none;
}

.loading::after {
content: '';
position: absolute;
top: 50%;
left: 50%;
width: 20px;
height: 20px;
margin: -10px 0 0 -10px;
border: 2px solid transparent;
border-top-color: currentColor;
border-radius: 50%;
animation: spin 1s linear infinite;
}

@keyframes spin {
to {
transform: rotate(360deg);
}
}

.spinner {
display: inline-block;
width: 20px;
height: 20px;
border: 2px solid transparent;
border-top-color: currentColor;
border-radius: 50%;
animation: spin 1s linear infinite;
margin-right: 8px;
}
</style>
</head>
<body>
<!-- Banner de notificaciones -->
<div id="notification-banner" class="notification-banner">
<div class="notification-content">
<span class="notification-text"></span>
<button class="notification-close" onclick="cerrarNotificacion()">√ó</button>
</div>
</div>

<div class="background-shapes">
<div class="shape"></div> <div class="shape"></div> <div class="shape"></div> <div class="shape"></div>
<!-- Part√≠culas din√°micas se crear√°n por JavaScript -->
</div>

<div id="popup-overlay" class="popup-overlay">
<div class="popup-content">
<div class="popup-title">¬°FELICITACIONES!</div>
<div id="popup-prize" class="popup-prize"></div>
<p class="popup-instructions">Recuerda enviarme una captura de pantalla para cobrar tu premio!</p>
<button id="popupCloseBtn" class="popup-close button">‚ú® ¬°Genial! ‚ú®</button>
</div>
</div>

<div class="container">
<div style="position: absolute; top: 20px; right: 20px; z-index: 100;">
<a href="admin.html" style="color: rgba(196, 69, 105, 0.4); text-decoration: none; font-size: 1.2em;">‚öôÔ∏è</a>
</div>
<div class="main-content">
<div class="controls-container">
<div class="controls-title" id="tituloModelo">VickyLuna</div>
<div class="controls-section">
<div class="form-title">üíù C√≥digo Exclusivo</div>
<div id="formulario">
<input type="text" id="codigo" placeholder="Introduce tu c√≥digo exclusivo" maxlength="20">
<button id="validarBtn" class="button">‚ú® Validar C√≥digo ‚ú®</button>
</div>
</div>
</div>
<div class="ruleta-section">
<div id="ruleta">
<div id="flecha"></div>
<canvas id="opciones" width="450" height="450"></canvas>
</div>
<button id="girarBtn" class="button" disabled>üéØ ¬°GIRAR RULETA! üéØ</button>
</div>
<!-- Historial de premios -->
<div class="historial-container" id="historial-container">
<div class="historial-section">
<div class="historial-title">üèÜ Mis Premios</div>
<div class="historial-lista" id="historial-lista">
<div class="historial-vacio" id="historial-vacio">
A√∫n no has ganado premios.<br>
¬°Gira la ruleta para empezar!
</div>
</div>
</div>
</div>
</div>
<div class="message-section">
<div id="mensaje">‚ú® Ingresa tu c√≥digo para comenzar la experiencia m√°gica ‚ú®</div>
</div>
</div>

<script>
// Variables globales para premios din√°micos
let premiosDisponibles = [];
const coloresPremios = [ "#ff6b9d", "#c44569", "#f8b500", "#ff9ff3", "#54a0ff", "#5f27cd", "#ff9f43", "#10ac84", "#ee5a24", "#0abde3", "#feca57", "#ff6348" ];

// Eliminado: const codigosValidosDefault - ahora usamos solo el backend
// Eliminado: let codigosValidos = {} - ahora usamos solo el backend

let premiosActuales = [];
let tiradasRestantes = 0;
let nombreUsuario = "";
let codigoActual = "";

// Variables para el historial de premios
let historialPremios = [];
let contadorPremios = 0;

// Funci√≥n auxiliar para obtener la rotaci√≥n actual
function getCurrentRotation(element) {
    const st = window.getComputedStyle(element, null);
    const tm = st.getPropertyValue("-webkit-transform") ||
               st.getPropertyValue("-moz-transform") ||
               st.getPropertyValue("-ms-transform") ||
               st.getPropertyValue("-o-transform") ||
               st.getPropertyValue("transform") ||
               "none";
    if (tm !== "none") {
        const values = tm.split('(')[1].split(')')[0].split(',');
        const a = values[0];
        const b = values[1];
        const angle = Math.round(Math.atan2(b, a) * (180/Math.PI));
        return (angle < 0) ? angle + 360 : angle;
    }
    return 0;
}

const soundClick = new Audio('sounds/click.wav');
const soundWin = new Audio('sounds/win.wav');
const soundSpin = new Audio('sounds/spin.wav');

// === SISTEMA DE NOTIFICACIONES ===
function mostrarNotificacion(mensaje, tipo = 'success') {
const banner = document.getElementById('notification-banner');
const textElement = banner.querySelector('.notification-text');

// Configurar el mensaje
textElement.textContent = mensaje;

// Limpiar clases anteriores y a√±adir la nueva
banner.className = `notification-banner ${tipo}`;

// Mostrar con animaci√≥n
banner.style.display = 'flex';
setTimeout(() => {
banner.classList.add('show');
}, 10);

// Auto-ocultar despu√©s de 4 segundos
setTimeout(() => {
cerrarNotificacion();
}, 4000);
}

function cerrarNotificacion() {
const banner = document.getElementById('notification-banner');
banner.classList.remove('show');

setTimeout(() => {
banner.style.display = 'none';
}, 400);
}

// === FUNCIONES DEL HISTORIAL DE PREMIOS ===
function inicializarHistorial() {
// Cargar historial desde localStorage
const historialGuardado = localStorage.getItem(`historial_${codigoActual}`);
if (historialGuardado) {
try {
historialPremios = JSON.parse(historialGuardado);
contadorPremios = historialPremios.length;
actualizarHistorialVisual();
} catch (error) {
console.error('Error al cargar historial guardado:', error);
historialPremios = [];
contadorPremios = 0;
}
} else {
historialPremios = [];
contadorPremios = 0;
}

// Mostrar el historial si hay premios o si se ha validado un c√≥digo
if (codigoActual) {
mostrarHistorial();
}
}

function agregarPremioAlHistorial(premio) {
contadorPremios++;
const nuevoPremio = {
id: contadorPremios,
nombre: premio,
fecha: new Date().toLocaleString('es-ES', {
day: '2-digit',
month: '2-digit',
year: 'numeric',
hour: '2-digit',
minute: '2-digit'
}),
timestamp: Date.now()
};

// Agregar al inicio del array para mostrar los m√°s recientes primero
historialPremios.unshift(nuevoPremio);

// Guardar en localStorage
try {
localStorage.setItem(`historial_${codigoActual}`, JSON.stringify(historialPremios));
} catch (error) {
console.error('Error al guardar historial:', error);
}

// Actualizar la visualizaci√≥n
actualizarHistorialVisual();

// Mostrar el historial si estaba oculto
mostrarHistorial();
}

function actualizarHistorialVisual() {
const historialLista = document.getElementById('historial-lista');
const historialVacio = document.getElementById('historial-vacio');

if (!historialLista) return;

if (historialPremios.length === 0) {
if (historialVacio) {
historialVacio.style.display = 'block';
}
return;
}

// Ocultar mensaje de historial vac√≠o
if (historialVacio) {
historialVacio.style.display = 'none';
}

// Crear HTML para cada premio
let historialHTML = '';
historialPremios.forEach((premio, index) => {
historialHTML += `
                   <div class="premio-item" style="animation: fadeInUp 0.5s ease ${index * 0.1}s both;">
                       <div class="premio-numero">${premio.id}</div>
                       <div class="premio-nombre">${premio.nombre}</div>
                       <div class="premio-fecha">
                           üïê ${premio.fecha}
                       </div>
                   </div>
               `;
});

historialLista.innerHTML = historialHTML;

// Hacer scroll al elemento m√°s reciente si es necesario
if (historialPremios.length > 0) {
setTimeout(() => {
historialLista.scrollTop = 0;
}, 100);
}
}

function mostrarHistorial() {
const historialContainer = document.getElementById('historial-container');
if (historialContainer) {
historialContainer.classList.add('visible');
}
}

function ocultarHistorial() {
const historialContainer = document.getElementById('historial-container');
if (historialContainer) {
historialContainer.classList.remove('visible');
}
}

// NUEVA FUNCI√ìN: Verificar progreso de premios √∫nicos
function verificarProgresoPremiosUnicos() {
    if (!premiosActuales || premiosActuales.length === 0) return { total: 0, ganados: 0, restantes: 0 };
    const premiosYaGanados = historialPremios.map(item => item.nombre);
    const premiosUnicos = [...new Set(premiosActuales)];
    const premiosUnicosGanados = [...new Set(premiosYaGanados.filter(p => premiosUnicos.includes(p)))];
    return {
        total: premiosUnicos.length,
        ganados: premiosUnicosGanados.length,
        restantes: premiosUnicos.length - premiosUnicosGanados.length
    };
}

function limpiarHistorial() {
historialPremios = [];
contadorPremios = 0;

try {
localStorage.removeItem(`historial_${codigoActual}`);
} catch (error) {
console.error('Error al limpiar historial:', error);
}

actualizarHistorialVisual();
}

// Comentada: funci√≥n cargarCodigosPersonalizados() - ahora usamos el backend
/*
       function cargarCodigosPersonalizados() {
           let todosLosCodigos = {...codigosValidosDefault};
           const codigosGuardados = localStorage.getItem('codigosPersonalizados');
           if (codigosGuardados) {
               Object.assign(todosLosCodigos, JSON.parse(codigosGuardados));
           }
           codigosValidos = todosLosCodigos;
       }
       */

// Nueva funci√≥n que usa el backend para marcar c√≥digos como usados
// FUNCI√ìN DEPRECADA - Ahora se maneja autom√°ticamente con gastar-tiro.js
/*
       async function marcarCodigoComoUsado(codigo) {
           try {
               const response = await fetch('/.netlify/functions/expire-code', {
                   method: 'POST',
                   headers: {
                       'Content-Type': 'application/json',
                   },
                   body: JSON.stringify({ codigoId: codigo })
               });

               const result = await response.json();
               
               if (!response.ok || !result.success) {
                   console.error('Error al marcar c√≥digo como usado:', result.message);
                   // No mostramos error al usuario para no interrumpir la experiencia
               }
           } catch (error) {
               console.error('Error de conexi√≥n al marcar c√≥digo como usado:', error);
               // No mostramos error al usuario para no interrumpir la experiencia
           }
       }
       */

function dibujarRuletaCompleta() {
// Solo dibujar usando premiosDisponibles (ya cargados por inicializarPagina)
if (!premiosDisponibles || premiosDisponibles.length === 0) {
console.error('No hay premios disponibles para dibujar la ruleta');
mostrarNotificacion('Error: No hay premios configurados para la ruleta.', 'error');
return;
}

const canvas = document.getElementById('opciones');
if (!canvas) {
console.error('Canvas #opciones no encontrado');
return;
}

const ctx = canvas.getContext('2d');
const total = premiosDisponibles.length;
const radio = 220;
const centroX = 225;
const centroY = 225;

ctx.clearRect(0, 0, 450, 450);

for (let i = 0; i < total; i++) {
const anguloInicio = (2 * Math.PI / total) * i;
const anguloFin = (2 * Math.PI / total) * (i + 1);

ctx.save();
ctx.beginPath();
ctx.moveTo(centroX, centroY);
ctx.arc(centroX, centroY, radio, anguloInicio, anguloFin);
ctx.closePath();
                ctx.fillStyle = coloresPremios[i % coloresPremios.length];
                
                // üé® COLORES CON MEJOR TRANSPARENCIA PARA EL FONDO PERSONALIZADO
                const baseColor = coloresPremios[i % coloresPremios.length];
                ctx.fillStyle = baseColor + 'E6'; // Agregar transparencia para que se vea el fondo
ctx.fill();
                
                // üé® SOMBRA SUTIL PARA MEJOR DEFINICI√ìN
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                ctx.fill();
                
ctx.clip();

                // üé® TEXTO CON MEJOR CONTRASTE
ctx.fillStyle = "#ffffff";
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
const anguloMedio = (anguloInicio + anguloFin) / 2;
const distanciaTexto = radio * 0.65;
const textoX = centroX + Math.cos(anguloMedio) * distanciaTexto;
const textoY = centroY + Math.sin(anguloMedio) * distanciaTexto;

ctx.translate(textoX, textoY);
let rotacion = anguloMedio;
if (rotacion > Math.PI/2 && rotacion < 3*Math.PI/2) rotacion += Math.PI;
ctx.rotate(rotacion);

let textoLimpio = premiosDisponibles[i].replace(/[\u{1F300}-\u{1F9FF}]/gu, '').trim().toUpperCase();
const palabras = textoLimpio.split(' ');
let lineas = [], lineaActual = '';
palabras.forEach(palabra => {
if ((lineaActual + palabra).length > 10 && lineaActual) {
lineas.push(lineaActual.trim());
lineaActual = palabra + ' ';
} else {
lineaActual += palabra + ' ';
}
});
lineas.push(lineaActual.trim());

ctx.textAlign = "center";
ctx.textBaseline = "middle";

// Tama√±o de fuente responsivo basado en el ancho de pantalla
let fontSize = 16;
let lineHeight = 18;

if (window.innerWidth <= 360) {
fontSize = 11;
lineHeight = 13;
} else if (window.innerWidth <= 480) {
fontSize = 12;
lineHeight = 14;
} else if (window.innerWidth <= 768) {
fontSize = 14;
lineHeight = 16;
} else if (window.innerWidth <= 992) {
fontSize = 15;
lineHeight = 17;
}

ctx.font = `bold ${fontSize}px Poppins, sans-serif`;
                ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;

const startY = -(lineas.length - 1) * lineHeight / 2;
lineas.forEach((linea, index) => ctx.fillText(linea, 0, startY + (index * lineHeight)));
ctx.restore();
}

            ctx.strokeStyle = "#ffffff";
            ctx.lineWidth = 3;
            // üé® L√çNEAS DE SEPARACI√ìN M√ÅS ELEGANTES
            ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
            ctx.lineWidth = 2;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 2;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
            
for (let i = 0; i < total; i++) {
const anguloFin = (2 * Math.PI / total) * (i + 1);
ctx.beginPath();
ctx.moveTo(centroX, centroY);
ctx.lineTo(centroX + radio * Math.cos(anguloFin), centroY + radio * Math.sin(anguloFin));
ctx.stroke();
}

            // C√≠rculo central responsivo
            // üé® C√çRCULO CENTRAL CON EFECTO GLASSMORPHISM
let circleRadius = 40;
let emojiSize = 40;

if (window.innerWidth <= 360) {
circleRadius = 28;
emojiSize = 28;
} else if (window.innerWidth <= 480) {
circleRadius = 32;
emojiSize = 32;
} else if (window.innerWidth <= 768) {
circleRadius = 35;
emojiSize = 35;
} else if (window.innerWidth <= 992) {
circleRadius = 38;
emojiSize = 38;
}

            // C√≠rculo con efecto de vidrio
ctx.beginPath();
ctx.arc(centroX, centroY, circleRadius, 0, 2 * Math.PI);
            ctx.fillStyle = "#c44569";
            
            // Gradiente radial para efecto de vidrio
            const gradient = ctx.createRadialGradient(centroX, centroY, 0, centroX, centroY, circleRadius);
            gradient.addColorStop(0, 'rgba(196, 69, 105, 0.9)');
            gradient.addColorStop(0.7, 'rgba(196, 69, 105, 0.7)');
            gradient.addColorStop(1, 'rgba(196, 69, 105, 0.5)');
            
            ctx.fillStyle = gradient;
ctx.fill();
            
            // Borde con sombra
            ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
            ctx.lineWidth = 3;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 5;
ctx.stroke();

            // Emoji central
ctx.fillStyle = "#ffffff";
ctx.font = `bold ${emojiSize}px Poppins, sans-serif`;
            ctx.shadowColor = 'transparent';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
            ctx.shadowBlur = 3;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
ctx.textBaseline = "middle";
ctx.textAlign = "center";
ctx.fillText("üíé", centroX, centroY + 4); // +4 para centrar visualmente el emoji
}

        async function girarRuleta() {
            if (tiradasRestantes <= 0 || premiosActuales.length === 0) return;

            // L√≥gica para no repetir premios
            const premiosYaGanados = historialPremios.map(item => item.nombre);
            const premiosDisponiblesParaEsteGiro = premiosActuales.filter(premio => !premiosYaGanados.includes(premio));

            if (premiosDisponiblesParaEsteGiro.length === 0) {
                mostrarNotificacion("¬°Ya has ganado todos los premios disponibles! üéâ", "success");
                mostrarMensaje(`üéâ ¬°Felicidades ${nombreUsuario}! Ya tienes todos los premios √∫nicos.`);
                document.getElementById('girarBtn').disabled = true;
                return; // Detener la ejecuci√≥n si no hay m√°s premios √∫nicos que ganar
            }

            // Configurar estado de carga del bot√≥n
            const girarBtn = document.getElementById('girarBtn');
            girarBtn.disabled = true;
            girarBtn.textContent = 'Girando... üé≤';

            soundSpin.loop = true;
            soundSpin.play();
            
            // Seleccionar un premio aleatorio de la lista FILTRADA
            const indiceGanadorEnPool = Math.floor(Math.random() * premiosDisponiblesParaEsteGiro.length);
            const premioGanado = premiosDisponiblesParaEsteGiro[indiceGanadorEnPool];
            const indiceEnRuletaCompleta = premiosDisponibles.findIndex(p => p === premioGanado);

            if (indiceEnRuletaCompleta === -1) {
                mostrarNotificacion("Error de configuraci√≥n. Por favor, intenta de nuevo.", "error");
                soundSpin.pause();
                return;
            }
            // --- INICIO DEL BLOQUE A REEMPLAZAR EN girarRuleta() ---
            const opcionesCanvas = document.getElementById('opciones');

            // 1. Obtener la rotaci√≥n actual y detener la animaci√≥n CSS
            const currentAngle = getCurrentRotation(opcionesCanvas);
            opcionesCanvas.classList.remove('is-idling');
            opcionesCanvas.style.transition = 'none'; // Evitar transiciones no deseadas
            opcionesCanvas.style.transform = `rotate(${currentAngle}deg)`;

            // Forzar un reflow del navegador para aplicar el transform est√°tico antes de la transici√≥n
            opcionesCanvas.offsetWidth; 

            // 2. Calcular el √°ngulo final del giro
            const anguloPorPremio = 360 / premiosDisponibles.length;
            // Se a√±aden varias vueltas + el √°ngulo del premio + el √°ngulo actual
            const anguloDeGiro = (360 * 6) + (indiceEnRuletaCompleta * anguloPorPremio) + (anguloPorPremio / 2);
            const anguloFinalTotal = currentAngle + anguloDeGiro;

            // 3. Aplicar la transici√≥n para el giro r√°pido
            opcionesCanvas.style.transition = "transform 5s cubic-bezier(.17,.67,.83,.67)";
            opcionesCanvas.style.transform = `rotate(${anguloFinalTotal}deg)`;

            mostrarMensaje("üéØ ¬°La ruleta est√° girando m√°gicamente! ‚ú®");

            // 4. Procesar el resultado despu√©s de que termine el giro
            setTimeout(async () => {
                soundSpin.pause();
                soundSpin.currentTime = 0;
                soundWin.play();

                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 },
                    gravity: 0.8
                });

                // Detener la transici√≥n para que la ruleta se quede fija en el premio
                opcionesCanvas.style.transition = 'none';

                // La l√≥gica del premio, historial y tiradas restantes sigue aqu√≠...
                // (El resto del c√≥digo dentro del setTimeout original)
                mostrarPopupPremio(premioGanado);
                mostrarMensaje(`üéâ ¬°Felicidades ${nombreUsuario}! Ganaste: <b>${premioGanado}</b>`);
                agregarPremioAlHistorial(premioGanado);

                tiradasRestantes--;

                try {
                    const response = await fetch('/.netlify/functions/gastar-tiro', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ codigoId: codigoActual })
                    });
                    const result = await response.json();
                    if (response.ok && result.success) {
                        if (result.tiradasRestantes !== undefined) tiradasRestantes = result.tiradasRestantes;
                    } else {
                        console.error('Error al gastar tiro:', result.message);
                        mostrarNotificacion('Hubo un problema al registrar tu tirada.', 'warning');
                    }
                } catch (error) {
                    console.error('Error de conexi√≥n al gastar tiro:', error);
                    mostrarNotificacion('Error de conexi√≥n al registrar la tirada.', 'warning');
                }

                // NUEVA L√ìGICA: Verificar si se han ganado todos los premios √∫nicos
                const premiosYaGanadosActualizados = historialPremios.map(item => item.nombre);
                const premiosUnicos = [...new Set(premiosActuales)]; // Eliminar duplicados si los hay
                const todosLosPremiosGanados = premiosUnicos.every(premio => premiosYaGanadosActualizados.includes(premio));

                if (tiradasRestantes > 0 && !todosLosPremiosGanados) {
                    // A√∫n hay tiradas y premios √∫nicos por ganar
                    setTimeout(() => {
                        document.getElementById('girarBtn').disabled = false;
                        document.getElementById('girarBtn').textContent = '‚ú® Girar Ruleta ‚ú®';
                        const progreso = verificarProgresoPremiosUnicos();
                        mostrarMensaje(`‚ú® ¬°Tienes ${tiradasRestantes} tirada(s) m√°s! Te faltan ${progreso.restantes} premio(s) por ganar.`);
                    }, 3000);
                } else if (todosLosPremiosGanados) {
                    // Se han ganado todos los premios √∫nicos
                    setTimeout(() => {
                        document.getElementById('girarBtn').disabled = true;
                        document.getElementById('girarBtn').textContent = 'üèÜ ¬°Todos los premios obtenidos!';
                        mostrarMensaje(`üéâ ¬°Incre√≠ble ${nombreUsuario}! Has ganado todos los premios √∫nicos disponibles üèÜ‚ú®`);
                        mostrarNotificacion(`¬°Felicidades! Has completado todos los premios √∫nicos ÔøΩ`, 'success');
                    }, 3000);
                } else {
                    // No hay m√°s tiradas
                    setTimeout(() => {
                        mostrarMensaje(`üåü ¬°Gracias por participar ${nombreUsuario}! Ha sido una experiencia m√°gica üíñ`);
                        mostrarNotificacion(`¬°Gracias por participar, ${nombreUsuario}! üåü`, 'success');
                    }, 3000);
                }

            }, 5200); // Fin del setTimeout principal
            // --- FIN DEL BLOQUE A REEMPLAZAR ---
}

async function validarCodigo() {
soundClick.play();
const codigoInput = document.getElementById('codigo');
const validarBtn = document.getElementById('validarBtn');
const codigo = codigoInput.value.trim().toUpperCase();

if (!codigo) {
mostrarMensaje("‚ùå Por favor ingresa un c√≥digo.");
codigoInput.style.animation = 'shake 0.5s ease-in-out';
setTimeout(() => { codigoInput.style.animation = ''; }, 500);
return;
}

validarBtn.disabled = true;
validarBtn.textContent = '‚è≥ Validando...';
mostrarMensaje("üîç Validando tu c√≥digo...");

try {
const response = await fetch('/.netlify/functions/validate-code', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ codigoId: codigo })
});

const result = await response.json();

if (response.status === 200 && result.success) {
const datosCodigo = result.data;

codigoActual = codigo;
nombreUsuario = datosCodigo.nombreFan;

// ‚úÖ CORRECCI√ìN: Mejorar gesti√≥n de premiosActuales
if (datosCodigo.premios && Array.isArray(datosCodigo.premios) && datosCodigo.premios.length > 0) {
// Usar premios espec√≠ficos del c√≥digo
premiosActuales = [...datosCodigo.premios];
console.log('‚úÖ Usando premios espec√≠ficos del c√≥digo:', premiosActuales);
} else if (premiosDisponibles && premiosDisponibles.length > 0) {
// Fallback a premios globales
premiosActuales = [...premiosDisponibles];
console.log('‚ö†Ô∏è Usando premios globales como fallback:', premiosActuales);
} else {
// √öltimo fallback a premios por defecto
premiosActuales = ['Premio Sorpresa', 'Pack Fotos Hot', 'Videollamada 5 minutos'];
console.warn('‚ö†Ô∏è Usando premios por defecto - no hay premios configurados');
}

tiradasRestantes = datosCodigo.tiradasRestantes || 0;

mostrarNotificacion(`¬°Bienvenida ${nombreUsuario}! C√≥digo v√°lido con ${tiradasRestantes} tirada(s) üéâ`, 'success');

// Habilitar bot√≥n de girar solo si hay tiradas disponibles
const girarBtn = document.getElementById('girarBtn');
if (girarBtn) {
    girarBtn.disabled = tiradasRestantes <= 0;
}

codigoInput.disabled = true;
validarBtn.disabled = true;

codigoInput.style.borderColor = '#10ac84';
validarBtn.style.background = 'linear-gradient(45deg, #10ac84, #00d2d3)';
validarBtn.textContent = '‚úÖ C√≥digo V√°lido';

// Inicializar el historial de premios
inicializarHistorial();

// Debe ejecutarse primero
const progreso = verificarProgresoPremiosUnicos();
if (progreso.completado) {
    mostrarMensaje(`üíñ ¬°Hola ${nombreUsuario}! Parece que ya has ganado todos los ${progreso.total} premios. ¬°Felicidades!`);
    girarBtn.disabled = true;
} else {
    mostrarMensaje(`üíñ ¬°Hola ${nombreUsuario}! Tienes ${tiradasRestantes} tirada(s) para ganar ${progreso.restantes} premio(s) restante(s). ¬°Mucha suerte!`);
}

} else {
mostrarNotificacion(`${result.message || 'C√≥digo no v√°lido o sin tiradas disponibles'}`, 'error');
mostrarMensaje(`‚ùå ${result.message || 'Error al validar el c√≥digo'}`);
codigoInput.style.animation = 'shake 0.5s ease-in-out';
setTimeout(() => { codigoInput.style.animation = ''; }, 500);
}

} catch (error) {
console.error('Error de conexi√≥n al validar c√≥digo:', error);
mostrarNotificacion("Error de conexi√≥n. Por favor, verifica tu internet e int√©ntalo de nuevo.", 'error');
mostrarMensaje("‚ùå Error de conexi√≥n. Por favor, verifica tu internet e int√©ntalo de nuevo.");
codigoInput.style.animation = 'shake 0.5s ease-in-out';
setTimeout(() => { codigoInput.style.animation = ''; }, 500);
} finally {
if (validarBtn.textContent !== '‚úÖ C√≥digo V√°lido') {
validarBtn.disabled = false;
validarBtn.textContent = '‚ú® Validar C√≥digo ‚ú®';
}
}
}

function mostrarPopupPremio(premio) {
document.getElementById('popup-prize').textContent = premio;
document.getElementById('popup-overlay').classList.add('show');
}

// C√ìDIGO CORREGIDO Y MEJORADO
function cerrarPopup() {
    soundClick.play();
    document.getElementById('popup-overlay').classList.remove('show');

    // ¬°AQU√ç EST√Å LA MAGIA! Se le dice a la ruleta que vuelva a girar lentamente.
    document.getElementById('opciones').classList.add('is-idling');
}

function mostrarMensaje(msg) {
const mensajeElement = document.getElementById('mensaje');
mensajeElement.innerHTML = msg;

// A√±adir clase de animaci√≥n
mensajeElement.classList.add('mensaje-update');

// Quitar la clase despu√©s de que termine la animaci√≥n
setTimeout(() => {
mensajeElement.classList.remove('mensaje-update');
}, 500);
}

// === FONDO INTERACTIVO REACTIVO AL MOUSE ===
function inicializarFondoInteractivo() {
const paleta = ['#ff6b9d', '#ffffff', '#f8b500', '#c44569', '#feca57', '#23a6d5', '#ff9a9e', '#8a2be2'];
let throttleTimer = null;

// Efecto √©pico de bienvenida
crearExplosionBienvenida(paleta);

document.addEventListener('mousemove', function(e) {
// Throttle para mejor rendimiento
if (throttleTimer) return;

throttleTimer = setTimeout(() => {
throttleTimer = null;
}, 50); // Crear part√≠cula cada 50ms m√°ximo

crearParticulaMouse(e.clientX, e.clientY, paleta);
});
}

function crearExplosionBienvenida(paleta) {
const centroX = window.innerWidth / 2;
const centroY = window.innerHeight / 2;

// Crear 30 part√≠culas desde el centro
for (let i = 0; i < 30; i++) {
setTimeout(() => {
crearParticulaBienvenida(centroX, centroY, paleta, i);
}, i * 50); // Escalonar la creaci√≥n
}
}

function crearParticulaBienvenida(x, y, paleta, index) {
const particula = document.createElement('div');
particula.className = 'mouse-particle';

// Tama√±o m√°s grande para el efecto de bienvenida
const tama√±o = Math.random() * 30 + 10;
const color = paleta[Math.floor(Math.random() * paleta.length)];

// Configurar estilos iniciales
particula.style.cssText = `
               width: ${tama√±o}px;
               height: ${tama√±o}px;
               background: ${color};
               left: ${x - tama√±o/2}px;
               top: ${y - tama√±o/2}px;
               box-shadow: 0 0 ${tama√±o}px ${color};
               opacity: 1;
               z-index: 5;
           `;

document.body.appendChild(particula);

// Animar hacia afuera en todas las direcciones
setTimeout(() => {
const angulo = (index / 30) * 2 * Math.PI;
const distancia = Math.random() * 300 + 200;
const moveX = Math.cos(angulo) * distancia;
const moveY = Math.sin(angulo) * distancia;
const scale = Math.random() * 1.5 + 0.5;

particula.style.transform = `translate(${moveX}px, ${moveY}px) scale(${scale}) rotate(720deg)`;
particula.style.opacity = '0';
}, 100);

// Limpiar despu√©s de la animaci√≥n
setTimeout(() => {
if (particula.parentNode) {
document.body.removeChild(particula);
}
}, 1500);
}

function crearParticulaMouse(x, y, paleta) {
const particula = document.createElement('div');
particula.className = 'mouse-particle';

// Tama√±o aleatorio entre 5px y 25px
const tama√±o = Math.random() * 20 + 5;

// Color aleatorio de la paleta
const color = paleta[Math.floor(Math.random() * paleta.length)];

// Configurar estilos iniciales
particula.style.cssText = `
               width: ${tama√±o}px;
               height: ${tama√±o}px;
               background: ${color};
               left: ${x - tama√±o/2}px;
               top: ${y - tama√±o/2}px;
               box-shadow: 0 0 ${tama√±o/2}px ${color};
               opacity: 0.8;
           `;

// A√±adir al body
document.body.appendChild(particula);

// Animar inmediatamente
setTimeout(() => {
const moveX = (Math.random() - 0.5) * 80; // Movimiento horizontal aleatorio
const moveY = (Math.random() - 0.5) * 80; // Movimiento vertical aleatorio
const scale = Math.random() * 2 + 0.5; // Escala final aleatoria

particula.style.transform = `translate(${moveX}px, ${moveY}px) scale(${scale})`;
particula.style.opacity = '0';
}, 10);

// Limpiar despu√©s de la animaci√≥n
setTimeout(() => {
if (particula.parentNode) {
document.body.removeChild(particula);
}
}, 1000);
}

// === INICIALIZACI√ìN MAESTRA DE LA P√ÅGINA ===
async function inicializarPagina() {
try {
console.log('üöÄ Iniciando carga de p√°gina...');

// 1. Crear elementos del DOM primero
crearElementosDOM();

// 2. Llamada √∫nica al backend para obtener toda la configuraci√≥n
const response = await fetch('/.netlify/functions/config-manager', {
method: 'GET',
headers: {
'Content-Type': 'application/json',
}
});

if (!response.ok) {
throw new Error(`HTTP error! status: ${response.status}`);
}

const result = await response.json();

if (result.success && result.data) {
console.log('‚úÖ Configuraci√≥n cargada exitosamente:', result.data);

// Procesar nombre de la modelo
if (result.data.nombreModelo) {
const tituloElement = document.querySelector('.controls-title');
if (tituloElement) {
tituloElement.textContent = `${result.data.nombreModelo} üíñ`;
}
// Tambi√©n actualizar el t√≠tulo de la p√°gina
document.title = `${result.data.nombreModelo} - Ruleta Interactiva`;
}

// Procesar avatar
if (result.data.avatarURL && result.data.avatarURL.trim() && result.data.avatarURL.startsWith('data:image/')) {
mostrarAvatar(result.data.avatarURL);
}

// Procesar y guardar premios en variable global
if (result.data.premios && Array.isArray(result.data.premios) && result.data.premios.length > 0) {
premiosDisponibles = [...result.data.premios];
console.log('‚úÖ Premios cargados:', premiosDisponibles);
} else {
// Premios por defecto si no hay configurados
premiosDisponibles = ['Premio Sorpresa', 'Pack Fotos Hot', 'Videollamada 5 minutos'];
console.warn('‚ö†Ô∏è No hay premios configurados, usando premios por defecto');
}

// 3. Despu√©s de procesar todos los datos, dibujar la ruleta
dibujarRuletaCompleta();

// Iniciar la animaci√≥n de rotaci√≥n lenta
document.getElementById('opciones').classList.add('is-idling');

} else {
throw new Error(result.message || 'Error en la respuesta del servidor');
}

} catch (error) {
console.error('‚ùå Error de conexi√≥n al cargar configuraci√≥n:', error);

// Usar configuraci√≥n por defecto en caso de error
premiosDisponibles = ['Premio Sorpresa', 'Pack Fotos Hot', 'Videollamada 5 minutos'];

// Mostrar t√≠tulo por defecto
const tituloElement = document.querySelector('.controls-title');
if (tituloElement) {
tituloElement.textContent = 'VickyLuna üíñ';
}

// Dibujar ruleta con configuraci√≥n por defecto
dibujarRuletaCompleta();

// Mostrar notificaci√≥n de error al usuario
setTimeout(() => {
mostrarNotificacion('No se pudo cargar la configuraci√≥n. Usando configuraci√≥n por defecto.', 'warning');
}, 1000);
}
}

// === FUNCI√ìN PARA CREAR ELEMENTOS DEL DOM ===
function crearElementosDOM() {
const controlsContainer = document.querySelector('.controls-container');
const ruletaSection = document.querySelector('.ruleta-section');

// Crear secci√≥n de controles
controlsContainer.innerHTML = `
               <div class="controls-section">
                   <h2 class="controls-title">VickyLuna üíñ</h2>
                   <div class="form-title">üéØEscribe tu C√≥digoüéØ</div>
                   <input type="text" id="codigo" placeholder="Escribe tu c√≥digo aqu√≠..." autocomplete="off">
                   <button id="validarBtn" class="button">‚ú® Validar C√≥digo ‚ú®</button>
               </div>
           `;

// Crear secci√≥n de ruleta
ruletaSection.innerHTML = `
               <div id="ruleta">
                   <div id="flecha"></div>
                   <canvas id="opciones" width="450" height="450"></canvas>
               </div>
               <button id="girarBtn" class="button" disabled>üé≤ ¬°Girar la Ruleta de la Suerte! üé≤</button>
           `;
}

// === CARGA DE CONFIGURACI√ìN VISUAL (DEPRECADA - USAR inicializarPagina) ===
async function cargarConfiguracionVisual() {
try {
const response = await fetch('/.netlify/functions/config-manager');
const result = await response.json();

if (response.ok && result.success && result.data) {
// Actualizar el nombre de la modelo
if (result.data.nombreModelo) {
const tituloElement = document.getElementById('tituloModelo');
if (tituloElement) {
tituloElement.textContent = result.data.nombreModelo;
}

// Tambi√©n actualizar el t√≠tulo de la p√°gina
document.title = `${result.data.nombreModelo} - Ruleta Interactiva`;
}

// Cargar y mostrar el avatar si existe
if (result.data.avatarURL && result.data.avatarURL.startsWith('data:image/')) {
mostrarAvatar(result.data.avatarURL);
}
}
} catch (error) {
console.error('Error al cargar configuraci√≥n visual:', error);
// No mostrar error al usuario, usar valores por defecto
}
}

function mostrarAvatar(avatarBase64) {
const container = document.getElementById('avatar-container');
if (!container) return;

// Limpiar contenido anterior
container.innerHTML = '';

// Crear nuevo elemento imagen
const img = document.createElement('img');
img.src = avatarBase64;

// Manejar carga de imagen
img.onload = function() {
// A√±adir imagen al contenedor
container.appendChild(img);

// Mostrar con animaci√≥n suave despu√©s de un peque√±o delay
setTimeout(() => {
container.classList.add('visible');
}, 300);
                
                // üé® APLICAR FONDO PERSONALIZADO A LA RULETA
                aplicarFondoRuleta(avatarBase64);
};

img.onerror = function() {
console.error('Error al cargar la imagen del avatar');
// Ocultar contenedor si hay error
container.classList.remove('visible');
                // Remover fondo de la ruleta si hay error
                removerFondoRuleta();
};
}
        
        function aplicarFondoRuleta(avatarBase64) {
            const ruleta = document.getElementById('ruleta');
            if (!ruleta) return;
            
            // Aplicar la imagen como fondo del pseudo-elemento ::before
            const style = document.createElement('style');
            style.id = 'ruleta-background-style';
            style.textContent = `
                #ruleta::before {
                    background-image: url('${avatarBase64}');
                }
            `;
            
            // Remover estilo anterior si existe
            const existingStyle = document.getElementById('ruleta-background-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // Agregar nuevo estilo
            document.head.appendChild(style);
            
            // Activar la clase para mostrar el fondo con transici√≥n suave
            setTimeout(() => {
                ruleta.classList.add('with-background');
            }, 500);
        }
        
        function removerFondoRuleta() {
            const ruleta = document.getElementById('ruleta');
            const style = document.getElementById('ruleta-background-style');
            
            if (ruleta) {
                ruleta.classList.remove('with-background');
            }
            
            if (style) {
                setTimeout(() => {
                    style.remove();
                }, 1000); // Esperar a que termine la transici√≥n
            }
        }

window.addEventListener('load', async () => {
// Funci√≥n maestra que inicializa toda la configuraci√≥n de la p√°gina
await inicializarPagina();

// Registrar eventos despu√©s de crear los elementos DOM
registrarEventos();

// Inicializar fondo interactivo reactivo al mouse
inicializarFondoInteractivo();
});

// === FUNCI√ìN PARA REGISTRAR EVENTOS ===
function registrarEventos() {
const validarBtn = document.getElementById('validarBtn');
const girarBtn = document.getElementById('girarBtn');
const popupCloseBtn = document.getElementById('popupCloseBtn');
const codigoInput = document.getElementById('codigo');

if (validarBtn) validarBtn.addEventListener('click', validarCodigo);
if (girarBtn) girarBtn.addEventListener('click', () => { soundClick.play(); girarRuleta(); });
if (popupCloseBtn) popupCloseBtn.addEventListener('click', cerrarPopup);
if (codigoInput) codigoInput.addEventListener('keypress', e => { if (e.key === 'Enter') validarCodigo(); });
}

// Redibujar ruleta cuando cambie el tama√±o de ventana para adaptaci√≥n responsiva
let resizeTimeout;
window.addEventListener('resize', () => {
clearTimeout(resizeTimeout);
resizeTimeout = setTimeout(() => {
if (premiosDisponibles && premiosDisponibles.length > 0) {
dibujarRuletaCompleta();
}
}, 250); // Debounce para evitar redibujado excesivo
});
</script>

<!-- Canvas Confetti Library -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</body>
</html>